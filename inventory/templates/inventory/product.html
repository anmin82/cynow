{% extends 'base.html' %}
{% load humanize %}

{% block title %}제품 재고{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="bi bi-box me-2"></i>제품 재고 (창입)</h2>
        <a href="{% url 'inventory:index' %}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left me-1"></i>돌아가기
        </a>
    </div>
    
    <!-- 필터 -->
    <div class="card mb-4">
        <div class="card-body">
            <form method="get" class="row g-3 align-items-end">
                <div class="col-md-3">
                    <label class="form-label">제품코드</label>
                    <input type="text" name="product_code" class="form-control" 
                           value="{{ filter_product_code }}" placeholder="예: KF020...">
                </div>
                <div class="col-md-3">
                    <label class="form-label">가스명</label>
                    <input type="text" name="gas_name" class="form-control" 
                           value="{{ filter_gas_name }}" placeholder="예: COS, CF4, CLF3...">
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="bi bi-search me-1"></i>검색
                    </button>
                </div>
                <div class="col-md-2">
                    <a href="{% url 'inventory:product' %}" class="btn btn-outline-secondary w-100">
                        초기화
                    </a>
                </div>
                <div class="col-md-2">
                    {% if show_all == '1' %}
                        <a href="{% url 'inventory:product' %}?product_code={{ filter_product_code }}&gas_name={{ filter_gas_name }}" class="btn btn-outline-primary w-100">
                            COS/CF4/CLF3만
                        </a>
                    {% else %}
                        <a href="{% url 'inventory:product' %}?show_all=1&product_code={{ filter_product_code }}&gas_name={{ filter_gas_name }}" class="btn btn-outline-primary w-100">
                            전체보기
                        </a>
                    {% endif %}
                </div>
            </form>
        </div>
    </div>
    
    <!-- 요약 -->
    <div class="alert alert-info">
        <i class="bi bi-info-circle me-2"></i>
        <strong>표시 기준:</strong>
        {% if show_all == '1' %}
            전체 제품
        {% else %}
            {{ core_gases|join:", " }}만
        {% endif %}
        &nbsp;|&nbsp;
        <strong>제품 종류:</strong> {{ total_products|intcomma }}개
        &nbsp;|&nbsp;
        <strong>총 재고:</strong> {{ total_qty|intcomma }}병
    </div>
    
    <!-- 재고 목록 -->
    <div class="card">
        <div class="card-header bg-light">
            <h6 class="mb-0">상세 목록</h6>
        </div>
        <div class="card-body">
            {% if inventory_list %}
            <table class="table table-hover">
                <thead class="table-light">
                    <tr>
                        <th>제품코드</th>
                        <th>제품명</th>
                        <th>가스</th>
                        <th>용기/밸브</th>
                        <th class="text-end">단가</th>
                        <th class="text-end">재고수량</th>
                        <th class="text-end">갱신</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in inventory_list %}
                    <tr>
                        <td class="fw-bold">{{ item.trade_condition_code }}</td>
                        <td>{{ item.product_display_name|default:"-" }}</td>
                        <td>{{ item.gas_name|default:"-" }}</td>
                        <td class="small text-muted">
                            {{ item.cylinder_spec_name|default:"-" }}
                            {% if item.valve_spec_name %}
                                <span class="mx-1">/</span>{{ item.valve_spec_name }}
                            {% endif %}
                        </td>
                        <td class="text-end">
                            {% if item.current_price %}
                                ₩{{ item.current_price|intcomma }}/kg
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td class="text-end">
                            <span class="badge bg-primary fs-6">{{ item.quantity|intcomma }}병</span>
                        </td>
                        <td class="text-end text-muted small">{{ item.updated_at|date:"m/d H:i" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="text-center text-muted py-4">제품 재고가 없습니다.</div>
            {% endif %}
        </div>
    </div>
    
    <!-- 안내 -->
    <div class="card mt-4 bg-light">
        <div class="card-body">
            <h6 class="mb-3"><i class="bi bi-info-circle me-2"></i>안내</h6>
            <ul class="mb-0 small text-muted">
                <li><strong>제품코드 (KF로 시작)</strong>: FCMS 시스템의 거래조건번호로, 가스+용기+밸브 조합을 식별합니다.</li>
                <li><strong>재고수량</strong>: 창고에 입고되어 있는 충전 완료 용기 개수입니다.</li>
                <li><strong>자동 동기화</strong>: 매일 자정에 자동으로 재고가 갱신됩니다.</li>
                <li>기본 표시는 {{ core_gases|join:", " }}만 보여주며, 필요 시 “전체보기”로 확장할 수 있습니다.</li>
            </ul>
        </div>
    </div>
</div>
{% endblock %}
