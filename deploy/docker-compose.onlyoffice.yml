# =============================================================================
# ONLYOFFICE Document Server Docker Compose
# =============================================================================
# 
# 설치 방법:
#   1. 이 파일을 서버에 복사
#   2. docker-compose -f docker-compose.onlyoffice.yml up -d
#   3. 약 1-2분 후 http://서버IP:8080 접속 확인
#
# Django 연동:
#   - ONLYOFFICE_URL=http://서버IP:8080
#   - ONLYOFFICE_JWT_SECRET=your-secret-key-here
#
# =============================================================================

version: '3.8'

services:
  onlyoffice:
    image: onlyoffice/documentserver:latest
    container_name: onlyoffice-docs
    restart: always
    ports:
      - "8080:80"
    environment:
      # JWT 보안 활성화 (필수)
      - JWT_ENABLED=true
      - JWT_SECRET=${ONLYOFFICE_JWT_SECRET:-cynow-onlyoffice-secret-2025}
      - JWT_HEADER=Authorization
      
      # 파일 크기 제한
      - DS_FILESIZE_MAX=104857600  # 100MB
      
      # 로그 레벨
      - LOG_LEVEL=WARNING
    
    volumes:
      # 로그 저장
      - onlyoffice_logs:/var/log/onlyoffice
      # 폰트 (선택사항)
      - onlyoffice_fonts:/var/www/onlyoffice/documentserver/core-fonts
    
    # 헬스체크
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/healthcheck"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

volumes:
  onlyoffice_logs:
  onlyoffice_fonts:

# =============================================================================
# 네트워크 설정 (Django와 같은 네트워크 사용 시)
# =============================================================================
# networks:
#   default:
#     external:
#       name: cynow_network

