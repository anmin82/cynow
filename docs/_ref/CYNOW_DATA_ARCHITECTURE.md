# SUPERSEDED: ?곸꽭 李멸퀬 臾몄꽌

??臾몄꽌???곸꽭 李멸퀬濡??좎??⑸땲?? **?뺥솗??理쒖떊 湲곗?(?뺣낯)? ?꾨옒 臾몄꽌瑜??곗꽑?⑸땲??**

- `docs/CYNOW_CANONICAL.md`

---

# CYNOW ?곗씠???꾪궎?띿쿂 醫낇빀 媛?대뱶

## 媛쒖슂

CYNOW ?쒖뒪?쒖쓽 ?꾩껜 ?곗씠??援ъ“, CDC ?뚯씠釉? CYNOW ?뚯씠釉? 洹몃━怨??뚯씠釉?媛?愿怨꾨? ?뺣━??醫낇빀 臾몄꽌?낅땲??
?덈줈??湲곕뒫 媛쒕컻 ????臾몄꽌瑜?李몄“?섏뿬 ?곗씠???뚯뒪? ?곌껐 愿怨꾨? ?뚯븙?????덉뒿?덈떎.

**理쒖쥌 媛깆떊**: 2024-12-27

---

## 紐⑹감

1. [?쒖뒪???꾪궎?띿쿂](#1-?쒖뒪???꾪궎?띿쿂)
2. [CDC ?뚯씠釉?(FCMS ?먯쿇)](#2-cdc-?뚯씠釉?fcms-?먯쿇)
3. [CYNOW ?뚯씠釉?(#3-cynow-?뚯씠釉?
4. [二쇱슂 ?뚯씠釉??곸꽭](#4-二쇱슂-?뚯씠釉??곸꽭)
5. [?곗씠???먮쫫](#5-?곗씠???먮쫫)
6. [ER ?ㅼ씠?닿렇??(#6-er-?ㅼ씠?닿렇??
7. [二쇱슂 荑쇰━ ?⑦꽩](#7-二쇱슂-荑쇰━-?⑦꽩)
8. [肄붾뱶 留ㅽ븨](#8-肄붾뱶-留ㅽ븨)

---

## 1. ?쒖뒪???꾪궎?띿쿂

```
?뚢???????????????????????????????????????????????????????????????????????
??                       FCMS (Oracle DB)                              ??
??                   [?먯쿇 ?쒖뒪??- ?쇰낯]                               ??
?붴???????????????????????????????????????????????????????????????????????
                                  ??
                                  ??CDC (Debezium)
                                  ??
?뚢???????????????????????????????????????????????????????????????????????
??                   PostgreSQL (cynow_db)                             ??
?? ?뚢????????????????????????????????????????????????????????????????  ??
?? ??           fcms_cdc ?ㅽ궎留?(CDC ?숆린???뚯씠釉?                 ??  ??
?? ?? - ma_cylinders, ma_items, ma_valve_specs...                  ??  ??
?? ?? - tr_latest_cylinder_statuses, tr_cylinder_status_histories  ??  ??
?? ?? - tr_orders, tr_move_reports, tr_move_report_details         ??  ??
?? ?붴????????????????????????????????????????????????????????????????  ??
?? ?뚢????????????????????????????????????????????????????????????????  ??
?? ??            public ?ㅽ궎留?(CYNOW ?먯껜 ?뚯씠釉?                  ??  ??
?? ?? - cy_cylinder_current (?⑷린 ?꾩옱 ?곹깭 ?ㅻ깄??                 ??  ??
?? ?? - Django ORM ?뚯씠釉붾뱾 (PO, ProductCode, Quote ??            ??  ??
?? ?붴????????????????????????????????????????????????????????????????  ??
?붴???????????????????????????????????????????????????????????????????????
                                  ??
                                  ??
?뚢???????????????????????????????????????????????????????????????????????
??                     CYNOW Django Application                        ??
??                    [??쒕낫?? ?섏＜愿由? 蹂닿퀬????                    ??
?붴???????????????????????????????????????????????????????????????????????
```

---

## 2. CDC ?뚯씠釉?(FCMS ?먯쿇)

**?ㅽ궎留?*: `fcms_cdc`

### 2.1 留덉뒪???뚯씠釉?(MA_*)

| ?뚯씠釉붾챸 | ?⑸룄 | PK | 二쇱슂 ?⑸룄 |
|---------|------|-----|----------|
| `ma_cylinders` | ?⑷린 留덉뒪??| CYLINDER_NO | ?⑷린 湲곕낯?뺣낫, ?ㅽ럺, ?댁븬?뺣낫 |
| `ma_items` | 媛???꾩씠??留덉뒪??| ITEM_CODE | 媛?ㅻ챸, ?깃툒, ?뱀꽦 |
| `ma_valve_specs` | 諛몃툕 ?ㅽ럺 留덉뒪??| VALVE_SPEC_CODE | 諛몃툕 ???CGA/DISS/DIN) |
| `ma_cylinder_specs` | ?⑷린 ?ㅽ럺 留덉뒪??| CYLINDER_SPEC_CODE | ?⑷린 ?ъ쭏, ?뺤떇 |
| `ma_parameters` | 肄붾뱶 留ㅽ븨 | TYPE, KEY1, KEY2, KEY3 | ?곹깭肄붾뱶, ?꾩튂肄붾뱶 ?섎? |

### 2.2 ?몃옖??뀡 ?뚯씠釉?(TR_*)

| ?뚯씠釉붾챸 | ?⑸룄 | PK/UK | 二쇱슂 ?⑸룄 |
|---------|------|-------|----------|
| `tr_latest_cylinder_statuses` | 理쒖떊 ?⑷린 ?곹깭 | CYLINDER_NO | ?꾩옱 ?곹깭, ?꾩튂, ?대룞?뺣낫 |
| `tr_cylinder_status_histories` | ?⑷린 ?곹깭 ?대젰 | CYLINDER_NO, HISTORY_SEQ | ?꾩껜 ?대룞 ?대젰, LOT?뺣낫 |
| `tr_orders` | 二쇰Ц(?대룞?? ?뺣낫 | ARRIVAL_SHIPPING_NO | 怨좉컼, ?쒗뭹肄붾뱶, ?섎웾 |
| `tr_order_informations` | 二쇰Ц ?곸꽭 ?뺣낫 | MOVE_REPORT_NO | ?덉젙??異⑹쟾/李쎌엯/異쒗븯) |
| `tr_move_reports` | ?대룞 蹂닿퀬??| MOVE_REPORT_NO | ?뺤젙?? LOT踰덊샇 |
| `tr_move_report_details` | ?대룞???곸꽭 | MOVE_REPORT_NO, CYLINDER_NO | ?⑷린-?대룞???곌껐, 臾닿쾶 |

---

## 3. CYNOW ?뚯씠釉?

**?ㅽ궎留?*: `public`

### 3.1 ?듭떖 ?댁쁺 ?뚯씠釉?

| ?뚯씠釉붾챸 | Django 紐⑤뜽 | ?⑸룄 |
|---------|------------|------|
| `cy_cylinder_current` | (Raw SQL) | ?⑷린 ?꾩옱 ?곹깭 ?ㅻ깄??(??쒕낫???듭떖) |

### 3.2 ?깅퀎 Django 紐⑤뜽

#### Core (core)
| 紐⑤뜽 | ?뚯씠釉붾챸 | ?⑸룄 |
|------|---------|------|
| Translation | translation | FCMS ?쇰낯?????쒓뎅??踰덉뿭 |
| EndUserMaster | enduser_master | EndUser 留덉뒪??(SDC, LGD ?? |
| EndUserDefault | enduser_default | 媛?ㅻ퀎 湲곕낯 EndUser ?뺤콉 |
| EndUserException | enduser_exception | ?⑷린踰덊샇蹂?EndUser ?덉쇅 |
| ValveGroup | valve_group | 諛몃툕 洹몃９ ?뺤쓽 |
| ValveGroupMapping | valve_group_mapping | 諛몃툕 ?ㅽ럺 ??洹몃９ 留ㅽ븨 |
| HiddenCylinderType | hidden_cylinder_type | ??쒕낫???④? ?⑷린醫낅쪟 |

#### Orders (orders) - ?섏＜愿由?
| 紐⑤뜽 | ?뚯씠釉붾챸 | ?⑸룄 |
|------|---------|------|
| PO | po | ?섏＜(Purchase Order) |
| POItem | po_item | ?섏＜ ?덈ぉ |
| PlannedMoveReport | planned_move_report | 媛諛쒗뻾 ?대룞??|
| FCMSMatchStatus | fcms_match_status | FCMS 留ㅼ묶 ?곹깭 |
| FCMSProductionProgress | fcms_production_progress | ?앹궛 吏꾩쿃 ?숆린??|

#### Products (products) - ?쒗뭹愿由?
| 紐⑤뜽 | ?뚯씠釉붾챸 | ?⑸룄 |
|------|---------|------|
| ProductCode | product_code | ?쒗뭹肄붾뱶(KFxxx) 留덉뒪??|
| ProductPriceHistory | product_price_history | ?④? 蹂寃??대젰 |
| ProductCodeSync | product_code_sync | FCMS ?숆린???대젰 |

#### Inventory (inventory) - ?ш퀬愿由?
| 紐⑤뜽 | ?뚯씠釉붾챸 | ?⑸룄 |
|------|---------|------|
| InventorySettings | inventory_settings | ?ш퀬 ?ㅼ젙 (留덇컧?쒓컙 ?? |
| InventoryTransaction | inventory_transaction | ?ш퀬 ?몃옖??뀡 濡쒓렇 |
| CylinderInventory | cylinder_inventory | ?⑷린 ?ш퀬 (??끖쀬긽?쑦쀬쐞移? |
| ProductInventory | product_inventory | ?쒗뭹 ?ш퀬 (?쒗뭹肄붾뱶횞李쎄퀬) |
| CylinderInventorySnapshot | cylinder_inventory_snapshot | ?⑷린 ?ш퀬 ?ㅻ깄??|
| ProductInventorySnapshot | product_inventory_snapshot | ?쒗뭹 ?ш퀬 ?ㅻ깄??|
| SnapshotLog | snapshot_log | ?ㅻ깄???앹꽦 濡쒓렇 |
| CylinderMaintenanceLog | cylinder_maintenance_log | ?뺣퉬 ?낆텧怨?濡쒓렇 |

#### History (history) - ?대젰/異붿씠
| 紐⑤뜽 | ?뚯씠釉붾챸 | ?⑸룄 |
|------|---------|------|
| HistInventorySnapshot | hist_inventory_snapshot | ?ш퀬 異붿씠 ?ㅻ깄??|
| HistSnapshotRequest | hist_snapshot_request | ?ㅻ깄???붿껌 |

#### Plans (plans) - 怨꾪쉷愿由?
| 紐⑤뜽 | ?뚯씠釉붾챸 | ?⑸룄 |
|------|---------|------|
| PlanForecastMonthly | plan_forecast_monthly | ?붾퀎 異쒗븯 怨꾪쉷 |
| PlanScheduledMonthly | plan_scheduled_monthly | ?붾퀎 ?ъ엯 怨꾪쉷 |
| PlanFillingMonthly | plan_filling_monthly | ?붾퀎 異⑹쟾 怨꾪쉷 |

#### Voucher (voucher) - 寃ъ쟻/臾몄꽌
| 紐⑤뜽 | ?뚯씠釉붾챸 | ?⑸룄 |
|------|---------|------|
| CompanyInfo | company_info | ?먯궗 ?뺣낫 |
| Customer | customer | 怨좉컼???뺣낫 |
| Quote | quote | 寃ъ쟻??|
| QuoteItem | quote_item | 寃ъ쟻 ?덈ぉ |
| DocumentTemplate | document_template | 臾몄꽌 ?쒗뵆由?|

---

## 4. 二쇱슂 ?뚯씠釉??곸꽭

### 4.1 ma_cylinders (?⑷린 留덉뒪??

```sql
-- 二쇱슂 而щ읆
CYLINDER_NO          -- PK, ?⑷린踰덊샇 (12?먮━)
ITEM_CODE            -- FK ??ma_items, 媛??醫낅쪟
CAPACITY             -- ?⑸웾 (L)
CYLINDER_SPEC_CODE   -- FK ??ma_cylinder_specs
VALVE_SPEC_CODE      -- FK ??ma_valve_specs
WEIGHT               -- ?⑷린 臾닿쾶 (kg)
WITHSTAND_PRESSURE_MAINTE_DATE  -- ?댁븬 ?쒗뿕??
WITHSTAND_PRESSURE_TEST_TERM    -- ?댁븬 二쇨린 (??
MANUFACTURE_DATE     -- ?쒖“??
```

### 4.2 tr_cylinder_status_histories (?⑷린 ?곹깭 ?대젰)

```sql
-- 二쇱슂 而щ읆
CYLINDER_NO          -- ?⑷린踰덊샇
HISTORY_SEQ          -- ?대젰 ?쒕쾲
MOVE_CODE            -- ?대룞 肄붾뱶 (10=?낇븯, 20=異⑹쟾, 50=李쎌엯, 60=異쒗븯 ??
MOVE_DATE            -- ?대룞?쇱떆
MOVE_REPORT_NO       -- ?대룞?쒕쾲??
CONDITION_CODE       -- ?곹깭 肄붾뱶

-- LOT ?뺣낫
MANUFACTURE_LOT_HEADER, MANUFACTURE_LOT_NO, MANUFACTURE_LOT_BRANCH  -- ?쒖“LOT
FILLING_LOT_HEADER, FILLING_LOT_NO, FILLING_LOT_BRANCH              -- 異⑹쟾LOT
FILLING_WEIGHT       -- 異⑹쟾 臾닿쾶

-- 愿?⑥옄 ?뺣낫
SUPPLIER_USER_NAME   -- 怨듦툒泥?
CUSTOMER_USER_NAME   -- 怨좉컼??
POSITION_USER_NAME   -- ?꾩튂
```

### 4.3 tr_orders (二쇰Ц/?대룞???뺣낫)

```sql
-- 二쇱슂 而щ읆
ARRIVAL_SHIPPING_NO      -- PK, ?대룞?쒕쾲??
CUSTOMER_ORDER_NO        -- 怨좉컼 二쇰Ц踰덊샇 (PO踰덊샇)
SUPPLIER_USER_CODE/NAME  -- 怨좉컼??
TRADE_CONDITION_CODE     -- ?쒗뭹肄붾뱶 (KFxxx)
ITEM_NAME               -- ?덈ぉ紐?
INSTRUCTION_COUNT       -- 吏???섎웾
DELIVERY_DATE           -- ?⑷린??
ORDER_DATE              -- 二쇰Ц??
```

### 4.4 tr_order_informations (二쇰Ц ?곸꽭/?쇱젙)

```sql
-- 二쇱슂 而щ읆
MOVE_REPORT_NO           -- PK, ?대룞?쒕쾲??
FILLING_PLAN_DATE        -- 異⑹쟾 ?덉젙??
WAREHOUSING_PLAN_DATE    -- 李쎌엯 ?덉젙??
SHIPPING_PLAN_DATE       -- 異쒗븯 ?덉젙??
SALES_REMARKS            -- ?곸뾽 鍮꾧퀬
PRODUCTION_REMARKS       -- ?앹궛 鍮꾧퀬
```

### 4.5 tr_move_reports (?대룞 蹂닿퀬??

```sql
-- 二쇱슂 而щ읆
MOVE_REPORT_NO           -- PK, ?대룞?쒕쾲??
PROGRESS_CODE            -- 吏꾪뻾 肄붾뱶 (51=痍⑥냼)
FILLING_DATE             -- 異⑹쟾 ?뺤젙??
SHIPPING_DATE            -- 異쒗븯 ?뺤젙??
FILLING_LOT_HEADER/NO/BRANCH  -- 異⑹쟾LOT
```

### 4.6 tr_move_report_details (?대룞???곸꽭)

```sql
-- 二쇱슂 而щ읆
MOVE_REPORT_NO      -- ?대룞?쒕쾲??
CYLINDER_NO         -- ?⑷린踰덊샇
ROW_NO              -- ?ㅻ뜑踰덊샇 (?쒖꽌)
CYLINDER_WEIGHT     -- ?⑷린 臾닿쾶
FILLING_WEIGHT      -- 異⑹쟾 臾닿쾶
ADD_DATETIME        -- ?깅줉?쇱떆
```

### 4.7 cy_cylinder_current (CYNOW ?⑷린 ?ㅻ깄??

```sql
-- ?앸퀎??
cylinder_no              -- PK, ?⑷린踰덊샇

-- Raw 媛?(FCMS ?먮낯)
raw_gas_name, raw_capacity, raw_valve_spec_code, raw_valve_spec_name
raw_cylinder_spec_code, raw_cylinder_spec_name, raw_condition_code

-- Dashboard 媛?(?뺤콉 ?곸슜)
dashboard_gas_name, dashboard_capacity
dashboard_valve_spec_name, dashboard_valve_group_name
dashboard_cylinder_spec_name, dashboard_enduser, dashboard_status

-- 吏묎퀎??
cylinder_type_key        -- ?⑷린醫낅쪟 ??(MD5 ?댁떆)
is_available             -- 媛???щ?

-- 硫뷀??곗씠??
pressure_expire_date     -- ?댁븬 留뚮즺??
last_event_at            -- 留덉?留??대깽??
snapshot_updated_at      -- ?ㅻ깄??媛깆떊 ?쒓컖
```

---

## 5. ?곗씠???먮쫫

### 5.1 ?⑷린 議고쉶 ?먮쫫

```
[??쒕낫??移대뱶 ?대┃]
       ??
       ??
cy_cylinder_current (?꾩옱 ?곹깭)
       ??
       ?쒋??[?곹깭媛 "蹂닿?"]?????⑷린 由ъ뒪???섏씠吏濡??대룞
       ??
       ?붴??[?곹깭媛 "異⑹쟾~?쒗뭹"]?????대룞?쒕퀎 ?⑷린 紐⑤떖
                                     ??
                                     ?쒋?? tr_move_report_details (?⑷린-?대룞???곌껐)
                                     ?쒋?? tr_orders (二쇰Ц ?뺣낫)
                                     ?쒋?? tr_order_informations (?덉젙??
                                     ?붴?? tr_move_reports (?뺤젙?? LOT)
```

### 5.2 ?섏＜ ??異쒗븯 ?먮쫫

```
[PO ?깅줉] ????[POItem] ????[PlannedMoveReport]
                                   ??
                                   ??FCMS ?낅젰 ??CDC ?숆린??
                           [tr_orders] ?먥?????????????????
                                   ??                   ??
                           [tr_move_reports]            ??
                                   ??                   ??
                           [tr_move_report_details]     ??
                                   ??                   ??
                           [tr_cylinder_status_histories]
                                   ??
              ?뚢?????????????????????쇄??????????????????????
              ??                   ??                   ??
        MOVE_CODE=20         MOVE_CODE=50         MOVE_CODE=60
          (異⑹쟾)               (李쎌엯)               (異쒗븯)
```

### 5.3 ?ш퀬 ?ㅻ깄???먮쫫

```
[留ㅼ씪 00:00 cron]
       ??
       ??
create_inventory_snapshot 紐낅졊??
       ??
       ?쒋?? sync_cylinder_inventory_from_current()
       ??     ?붴?? cy_cylinder_current ??CylinderInventory
       ??
       ?쒋?? sync_product_inventory_from_documents()
       ??     ?붴?? tr_cylinder_status_histories (MOVE_CODE=50) 
       ??         + tr_orders ??ProductInventory
       ??
       ?붴?? create_daily_snapshot()
              ?쒋?? CylinderInventory ??CylinderInventorySnapshot
              ?붴?? ProductInventory ??ProductInventorySnapshot
```

---

## 6. ER ?ㅼ씠?닿렇??

### 6.1 CDC ?뚯씠釉?愿怨?

```
?뚢???????????????????????    ?뚢???????????????????????
??   ma_cylinders     ??    ??     ma_items       ??
?귘???????????????????????    ?귘???????????????????????
??CYLINDER_NO (PK)    ?귘?????뜯봻 ITEM_CODE (PK)      ??
??ITEM_CODE (FK)      ??    ??DISPLAY_NAME        ??
??CYLINDER_SPEC_CODE  ??    ??FORMAL_NAME         ??
??VALVE_SPEC_CODE     ??    ?붴???????????????????????
??CAPACITY, WEIGHT    ??
?붴???????????р????????????
           ??
           ??    ?뚢???????????????????????
           ??    ?? ma_cylinder_specs  ??
           ?쒋?????뜯봻???????????????????????
           ??    ??CYLINDER_SPEC_CODE  ??
           ??    ??NAME                ??
           ??    ?붴???????????????????????
           ??
           ??    ?뚢???????????????????????
           ??    ??  ma_valve_specs    ??
           ?붴?????뜯봻???????????????????????
                 ??VALVE_SPEC_CODE     ??
                 ??NAME                ??
                 ?붴???????????????????????

?뚢???????????????????????????????????????????????????????????????
??             tr_cylinder_status_histories                    ??
?귘???????????????????????????????????????????????????????????????
??CYLINDER_NO, HISTORY_SEQ (PK)                               ??
??MOVE_CODE, MOVE_DATE, MOVE_REPORT_NO                        ??
??MANUFACTURE_LOT_*, FILLING_LOT_*, FILLING_WEIGHT            ??
?붴???????????????????????????????????????????????????????????????
                              ??
                              ??MOVE_REPORT_NO
                              ??
?뚢???????????????????????????????????????????????????????????????
??                       tr_orders                             ??
?귘???????????????????????????????????????????????????????????????
??ARRIVAL_SHIPPING_NO (PK) = MOVE_REPORT_NO                   ??
??CUSTOMER_ORDER_NO, SUPPLIER_USER_NAME                       ??
??TRADE_CONDITION_CODE (?쒗뭹肄붾뱶 KFxxx)                        ??
??INSTRUCTION_COUNT, DELIVERY_DATE                            ??
?붴???????????????????????????????????????????????????????????????
          ??                                   ??
          ??MOVE_REPORT_NO                     ??MOVE_REPORT_NO
          ??                                   ??
?뚢???????????????????????????   ?뚢???????????????????????????????
??tr_order_informations   ??   ??    tr_move_reports         ??
?귘???????????????????????????   ?귘???????????????????????????????
??MOVE_REPORT_NO (PK)     ??   ??MOVE_REPORT_NO (PK)         ??
??FILLING_PLAN_DATE       ??   ??FILLING_DATE (?뺤젙)         ??
??WAREHOUSING_PLAN_DATE   ??   ??SHIPPING_DATE (?뺤젙)        ??
??SHIPPING_PLAN_DATE      ??   ??FILLING_LOT_*               ??
?붴???????????????????????????   ?붴???????????????????????????????
                                              ??
                                              ??MOVE_REPORT_NO
                                              ??
                               ?뚢???????????????????????????????
                               ??  tr_move_report_details    ??
                               ?귘???????????????????????????????
                               ??MOVE_REPORT_NO, CYLINDER_NO ??
                               ??ROW_NO (?ㅻ뜑踰덊샇)            ??
                               ??CYLINDER_WEIGHT             ??
                               ??FILLING_WEIGHT              ??
                               ?붴???????????????????????????????
```

### 6.2 CYNOW-FCMS ?곌껐 愿怨?

```
?뚢???????????????????????????????????????????????????????????????
??                   CYNOW ?뚯씠釉?                             ??
?붴???????????????????????????????????????????????????????????????
           ??
    ?뚢???????닳????????????????????????????????????????????
    ??                                                 ??
    ??                                                 ??
?뚢????????????????????                   ?뚢????????????????????????
??cy_cylinder_     ??                   ??    ProductCode      ??
??current          ??                   ?귘????????????????????????
?귘????????????????????                   ??trade_condition_code ??
??cylinder_no ??????쇄?????ma_cylinders   ??(= KFxxx)            ??
??cylinder_type_   ??                   ??                     ??
??key              ??                   ?붴???????????р?????????????
?붴????????????????????                              ??
                                                   ???곌껐
                                                   ??
                                    ?뚢????????????????????????????
                                    ??tr_orders.               ??
                                    ??TRADE_CONDITION_CODE     ??
                                    ?붴????????????????????????????

?뚢????????????????????
??      PO         ??
?귘????????????????????
??customer_order_  ?귘?????tr_orders.CUSTOMER_ORDER_NO
??no               ??
?붴????????????????????
```

---

## 7. 二쇱슂 荑쇰━ ?⑦꽩

### 7.1 ?⑷린 ?꾩옱 ?곹깭 議고쉶

```sql
SELECT * FROM cy_cylinder_current
WHERE cylinder_type_key = 'xxx'
  AND dashboard_status = '異⑹쟾以?;
```

### 7.2 ?⑷린???대룞???곌껐 議고쉶

```sql
-- tr_move_report_details ?곗꽑, ?놁쑝硫?tr_cylinder_status_histories
WITH detail_links AS (
    SELECT DISTINCT ON (TRIM(d."CYLINDER_NO"))
        TRIM(d."CYLINDER_NO") as cylinder_no,
        TRIM(d."MOVE_REPORT_NO") as move_report_no,
        d."ROW_NO" as row_no
    FROM fcms_cdc.tr_move_report_details d
    ORDER BY TRIM(d."CYLINDER_NO"), d."ADD_DATETIME" DESC
)
SELECT * FROM detail_links;
```

### 7.3 ?대룞??+ 二쇰Ц + ?쇱젙 議고쉶

```sql
SELECT 
    o."ARRIVAL_SHIPPING_NO" as move_report_no,
    o."CUSTOMER_ORDER_NO",
    o."SUPPLIER_USER_NAME" as customer_name,
    o."TRADE_CONDITION_CODE" as product_code,
    oi."FILLING_PLAN_DATE",
    oi."WAREHOUSING_PLAN_DATE",
    oi."SHIPPING_PLAN_DATE",
    m."FILLING_DATE",
    m."SHIPPING_DATE",
    CONCAT(m."FILLING_LOT_HEADER", m."FILLING_LOT_NO", 
           CASE WHEN m."FILLING_LOT_BRANCH" != '' THEN '-' || m."FILLING_LOT_BRANCH" END) as filling_lot
FROM fcms_cdc.tr_orders o
LEFT JOIN fcms_cdc.tr_order_informations oi ON o."ARRIVAL_SHIPPING_NO" = oi."MOVE_REPORT_NO"
LEFT JOIN fcms_cdc.tr_move_reports m ON o."ARRIVAL_SHIPPING_NO" = m."MOVE_REPORT_NO";
```

### 7.4 LOT ?뺣낫 援ъ꽦

```sql
-- ?쒖“LOT
CONCAT(
    COALESCE(h."MANUFACTURE_LOT_HEADER", ''),
    COALESCE(h."MANUFACTURE_LOT_NO", ''),
    CASE WHEN h."MANUFACTURE_LOT_BRANCH" IS NOT NULL AND h."MANUFACTURE_LOT_BRANCH" != '' 
         THEN '-' || h."MANUFACTURE_LOT_BRANCH" ELSE '' END
) as manufacture_lot

-- 異⑹쟾LOT
CONCAT(
    COALESCE(h."FILLING_LOT_HEADER", ''),
    COALESCE(h."FILLING_LOT_NO", ''),
    CASE WHEN h."FILLING_LOT_BRANCH" IS NOT NULL AND h."FILLING_LOT_BRANCH" != '' 
         THEN '-' || h."FILLING_LOT_BRANCH" ELSE '' END
) as filling_lot
```

---

## 8. 肄붾뱶 留ㅽ븨

### 8.1 MOVE_CODE (?대룞 肄붾뱶)

| 肄붾뱶 | ?쒓?紐?| ?ㅻ챸 |
|------|-------|------|
| 00 | ?좉퇋援щℓ | ???⑷린 援щℓ |
| 01 | ?좉퇋?깅줉 | ?쒖뒪???깅줉 |
| 10 | ?낇븯 | 怨좉컼?쇰줈遺???⑷린 ?낇븯 |
| 14 | ?뚯닔?꾨즺 | ?뚯닔 ?꾨즺 |
| 16 | ?뚯닔?놁쓬 | ?뚯닔 遺덇? |
| 17 | ?щ낫愿 | ?щ낫愿 泥섎━ |
| 19 | ?댁긽泥섎━ | ?댁긽 ?곹깭 泥섎━ |
| 20 | 異⑹쟾(?쒖옉) | 異⑹쟾 ?쒖옉 |
| 21 | 異⑹쟾?좏깮 | 異⑹쟾 ?좏깮 |
| 22 | 異⑹쟾?꾨즺 | 異⑹쟾 ?꾨즺 |
| 30 | 李쎄퀬異쒓퀬 | 李쎄퀬?먯꽌 異쒓퀬 |
| 31 | ?몃?異⑹쟾 | ?몃? 異⑹쟾 |
| 41 | 遺꾩꽍以?| 遺꾩꽍 吏꾪뻾 |
| 42 | 遺꾩꽍?꾨즺 | 遺꾩꽍 ?꾨즺 |
| 50 | 李쎄퀬?낃퀬 | 李쎄퀬???낃퀬 (?쒗뭹 ?꾩꽦) |
| 51 | ?섏＜?곌껐 | ?섏＜? ?곌껐 |
| 52 | ?곌껐?댁젣 | ?섏＜ ?곌껐 ?댁젣 |
| 60 | 異쒗븯 | 怨좉컼?먭쾶 異쒗븯 |
| 65 | ?곸뾽?몄텧??| ?곸뾽 ??異쒗븯 |
| 70 | 諛섑뭹 | 諛섑뭹 泥섎━ |
| 85 | ?꾩텧 | ? ?ъ뾽???꾩텧 |
| 86 | ?꾩엯 | ? ?ъ뾽???꾩엯 |
| 99 | ?먭린 | ?⑷린 ?먭린 |

### 8.2 CONDITION_CODE (?곹깭 肄붾뱶) ??dashboard_status

| 肄붾뱶 | dashboard_status | ?ㅻ챸 |
|------|-----------------|------|
| 100, 102 | 蹂닿?:誘명쉶?? 蹂닿?:?뚯닔 | 李쎄퀬 蹂닿? ?곹깭 |
| 210, 220 | 異⑹쟾以? 異⑹쟾?꾨즺 | 異⑹쟾 怨듭젙 |
| 300, 310, 320 | 遺꾩꽍以? 遺꾩꽍?꾨즺 | 遺꾩꽍/寃??怨듭젙 |
| 420 | 遺꾩꽍 | 遺꾩꽍 ?곹깭 |
| 500 | ?쒗뭹 | 李쎄퀬?낃퀬 ?꾨즺 (異쒗븯 媛?? |
| 600 | 異쒗븯 | 怨좉컼?먭쾶 異쒗븯 ?꾨즺 |
| 190 | ?댁긽 | ?댁긽 ?곹깭 |
| 950, 952 | ?뺣퉬???| ?댁븬留뚮즺 ???뺣퉬 ?꾩슂 |
| 990 | ?먭린 | ?먭린 ?꾨즺 |

### 8.3 二쇱슂 ?곹깭 援щ텇

| 援щ텇 | ?곹깭 | is_available |
|------|------|--------------|
| **媛??* | 蹂닿?:誘명쉶?? 蹂닿?:?뚯닔 | TRUE |
| **怨듭젙以?* | 異⑹쟾以? 異⑹쟾?꾨즺, 遺꾩꽍以? 遺꾩꽍?꾨즺, ?쒗뭹 | FALSE |
| **異쒗븯** | 異쒗븯 | FALSE |
| **鍮꾧???* | ?댁긽, ?뺣퉬??? ?먭린, 湲고? | FALSE |

---

## 遺濡? ?먯＜ ?ъ슜?섎뒗 議곗씤 ?⑦꽩

### A. ?⑷린 湲곕낯?뺣낫 + 媛???ㅽ럺

```sql
SELECT 
    c."CYLINDER_NO",
    COALESCE(i."DISPLAY_NAME", i."FORMAL_NAME") as gas_name,
    c."CAPACITY",
    vs."NAME" as valve_spec,
    cs."NAME" as cylinder_spec
FROM fcms_cdc.ma_cylinders c
LEFT JOIN fcms_cdc.ma_items i ON c."ITEM_CODE" = i."ITEM_CODE"
LEFT JOIN fcms_cdc.ma_valve_specs vs ON c."VALVE_SPEC_CODE" = vs."VALVE_SPEC_CODE"
LEFT JOIN fcms_cdc.ma_cylinder_specs cs ON c."CYLINDER_SPEC_CODE" = cs."CYLINDER_SPEC_CODE";
```

### B. ?⑷린 ?꾩옱?곹깭 + ?덉뒪?좊━

```sql
SELECT 
    cc.*,
    tcs."MOVE_REPORT_NO",
    tcs."MOVE_DATE"
FROM cy_cylinder_current cc
LEFT JOIN fcms_cdc.tr_latest_cylinder_statuses tcs 
    ON cc.cylinder_no = TRIM(tcs."CYLINDER_NO");
```

### C. ?대룞???꾩껜 ?뺣낫

```sql
SELECT 
    o.*,
    oi."FILLING_PLAN_DATE", oi."WAREHOUSING_PLAN_DATE", oi."SHIPPING_PLAN_DATE",
    m."FILLING_DATE", m."SHIPPING_DATE",
    m."FILLING_LOT_HEADER" || m."FILLING_LOT_NO" as filling_lot
FROM fcms_cdc.tr_orders o
LEFT JOIN fcms_cdc.tr_order_informations oi ON o."ARRIVAL_SHIPPING_NO" = oi."MOVE_REPORT_NO"
LEFT JOIN fcms_cdc.tr_move_reports m ON o."ARRIVAL_SHIPPING_NO" = m."MOVE_REPORT_NO"
WHERE m."PROGRESS_CODE" IS NULL OR m."PROGRESS_CODE" != '51';  -- 痍⑥냼 ?쒖쇅
```

---

## 蹂寃??대젰

| ?좎쭨 | 蹂寃??댁슜 |
|------|----------|
| 2024-12-27 | 珥덇린 ?묒꽦 |
