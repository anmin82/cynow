{% extends "base.html" %}

{% block title %}제품견적 - CYNOW{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="page-title">제품견적</h1>
        <p class="page-subtitle">견적서 조회 및 관리</p>
    </div>
    <div class="d-flex gap-2">
        <a href="{% url 'voucher:price_list' %}" class="btn btn-outline-light">
            <i class="bi bi-file-earmark-word"></i> 단가표 생성
        </a>
        <a href="{% url 'voucher:quote_create' %}" class="btn btn-primary">
            <i class="bi bi-plus-lg"></i> 새 견적서
        </a>
    </div>
</div>

<!-- 필터 -->
<div class="filter-section">
    <form method="get" class="row g-3 align-items-end">
        <div class="col-md-3">
            <label class="form-label">상태</label>
            <select name="status" class="form-select">
                <option value="">전체</option>
                {% for code, label in status_choices %}
                <option value="{{ code }}" {% if request.GET.status == code %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-4">
            <label class="form-label">검색</label>
            <input type="text" name="q" class="form-control" placeholder="견적번호, 건명, 거래처..." value="{{ request.GET.q }}">
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn btn-primary w-100">
                <i class="bi bi-search"></i> 검색
            </button>
        </div>
    </form>
</div>

<!-- 견적서 목록 -->
<div class="card">
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th>견적번호</th>
                        <th>견적건명</th>
                        <th>거래처</th>
                        <th>견적일자</th>
                        <th>금액</th>
                        <th>상태</th>
                        <th class="text-center">액션</th>
                    </tr>
                </thead>
                <tbody>
                    {% for quote in quotes %}
                    <tr>
                        <td>
                            <a href="{% url 'voucher:quote_detail' quote.pk %}" class="fw-bold">
                                {{ quote.quote_no }}
                            </a>
                        </td>
                        <td>{{ quote.title }}</td>
                        <td>
                            {% if quote.customer %}
                            <span class="badge text-bg-light border">{{ quote.customer.name }}</span>
                            {% else %}
                            <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>{{ quote.quote_date|date:"Y-m-d" }}</td>
                        <td class="text-end">
                            {% if quote.total_amount %}
                            <strong>{{ quote.total_amount|floatformat:0 }}</strong>
                            <small class="text-muted">{{ quote.default_currency }}</small>
                            {% else %}
                            <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if quote.status == 'DRAFT' %}
                            <span class="badge bg-secondary">작성중</span>
                            {% elif quote.status == 'SENT' %}
                            <span class="badge bg-primary">발송완료</span>
                            {% elif quote.status == 'ACCEPTED' %}
                            <span class="badge bg-success">수락</span>
                            {% elif quote.status == 'REJECTED' %}
                            <span class="badge bg-danger">거절</span>
                            {% elif quote.status == 'EXPIRED' %}
                            <span class="badge bg-warning text-dark">만료</span>
                            {% endif %}
                        </td>
                        <td class="text-center">
                            <div class="btn-group btn-group-sm">
                                <a href="{% url 'voucher:quote_detail' quote.pk %}" class="btn btn-outline-light" title="상세">
                                    <i class="bi bi-eye"></i>
                                </a>
                                <a href="{% url 'voucher:quote_edit' quote.pk %}" class="btn btn-outline-light" title="수정">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <a href="{% url 'voucher:quote_download' quote.pk %}" class="btn btn-outline-light" title="다운로드">
                                    <i class="bi bi-download"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="7" class="text-center py-5 text-muted">
                            <i class="bi bi-inbox" style="font-size: 3rem;"></i>
                            <p class="mt-3 mb-0">견적서가 없습니다.</p>
                            <a href="{% url 'voucher:quote_create' %}" class="btn btn-primary mt-3">
                                <i class="bi bi-plus-lg"></i> 첫 견적서 만들기
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- 요약 -->
{% if quotes %}
<div class="mt-3 text-muted small">
    총 {{ quotes|length }}건의 견적서
</div>
{% endif %}
{% endblock %}

