{% extends 'base.html' %}
{% block title %}LOT 정보 조회 - CYNOW{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-start mb-4">
    <div>
        <h1 class="page-title">LOT 정보 조회</h1>
        <p class="page-subtitle">용기별 제조LOT/충전LOT/이동서/충전중량 조회 (공백 다중검색 지원)</p>
    </div>
    <div class="d-flex gap-2">
        <a href="{% url 'history:history' %}" class="btn btn-outline-secondary btn-sm">전체 이력</a>
        <a href="{% url 'history:history_charge_export' %}?search={{ search_query|urlencode }}&cylinder_type_key={{ cylinder_type_key }}&start_date={{ start_date|date:'Y-m-d' }}&end_date={{ end_date|date:'Y-m-d' }}" class="btn btn-success btn-sm">
            <i class="bi bi-file-earmark-excel"></i> 엑셀
        </a>
    </div>
</div>

<div class="card mb-3">
    <div class="card-body">
        {% if error_message %}
        <div class="alert alert-warning mb-3">{{ error_message }}</div>
        {% endif %}
        <form method="get" class="row g-2 align-items-end">
            <div class="col-md-3">
                <label class="form-label">시작일</label>
                <input type="date" name="start_date" class="form-control form-control-sm" value="{{ start_date|date:'Y-m-d' }}">
            </div>
            <div class="col-md-3">
                <label class="form-label">종료일</label>
                <input type="date" name="end_date" class="form-control form-control-sm" value="{{ end_date|date:'Y-m-d' }}">
            </div>
            <div class="col-md-6">
                <label class="form-label">검색</label>
                <div class="input-group input-group-sm">
                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                    <input type="text" name="search" class="form-control" value="{{ search_query }}" autocomplete="off"
                           placeholder="가스명, 용기번호, 제조LOT, 충전LOT, 이동서번호 (공백으로 다중어 AND 검색)">
                    {% if cylinder_type_key %}
                    <input type="hidden" name="cylinder_type_key" value="{{ cylinder_type_key }}">
                    {% endif %}
                    <button type="submit" class="btn btn-primary">조회</button>
                    <a href="{% url 'history:history_charge' %}?reset=1" class="btn btn-outline-secondary">초기화</a>
                </div>
            </div>
        </form>
        {% if search_query %}
        <div class="mt-2 small text-muted">
            검색어: "<strong>{{ search_query }}</strong>" / 결과: <strong>{{ total_count }}</strong>건 (용기 기준)
        </div>
        {% endif %}
    </div>
</div>

<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <span>검색 결과</span>
        <span class="badge bg-primary">{{ total_count }}건</span>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover table-sm mb-0 align-middle" style="font-size:12px;">
                <thead>
                    <tr>
                        <th>용기번호</th>
                        <th>가스명</th>
                        <th>용기종류</th>
                        <th>이동서번호</th>
                        <th>밸브종류</th>
                        <th>용기용량</th>
                        <th class="text-end">충전중량</th>
                        <th>제조LOT</th>
                        <th>충전LOT</th>
                    </tr>
                </thead>
                <tbody>
                    {% for r in results %}
                    <tr>
                        <td class="font-monospace">{{ r.cylinder_no }}</td>
                        <td>{{ r.gas_name }}</td>
                        <td class="text-muted">{{ r.cylinder_type_label }}</td>
                        <td class="font-monospace">{{ r.move_report_no|default:"-" }}</td>
                        <td>{{ r.valve_type|default:"-" }}</td>
                        <td>{{ r.capacity|default:"-" }}</td>
                        <td class="text-end">{{ r.net_weight|default:"-" }}</td>
                        <td class="font-monospace">{{ r.manufacture_lot|default:"-" }}</td>
                        <td class="font-monospace">{{ r.filling_lot|default:"-" }}</td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="9" class="text-center text-muted py-5">데이터가 없습니다.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

